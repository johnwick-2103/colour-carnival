{% extends 'base.html' %}
{% load static %}

{% block content %}
<!-- Hero Section -->
<section class="hero">
    <img src="{% static 'images/logo.jpeg' %}" alt="Ambajogai Color Festival Logo" class="hero-logo">
    <h1>Colour Carnival 1.0</h1>
    <p>The Ultimate Holi Party of the Year!</p>
    <a href="#events" class="btn-primary">Get Your Tickets</a>
</section>

<!-- About Section -->
<section id="about" class="about-section">
    <h2>About the Festival</h2>
    <div class="content-grid">
        <p>We are excited to launch Ambajogai Color Festival! Ambajogai's Biggest Holi Festival, with more fun, more
            entertainment, and more memories.</p>
    </div>
</section>

<!-- Events Section -->
<section id="events" class="events-section">
    <h2>Our Events</h2>
    <div class="venue-grid">
        {% for event in events %}
        <div class="venue-card">
            {% if event.image %}
            <img src="{{ event.image.url }}" alt="{{ event.title }}"
                style="width:100%; border-radius:10px; margin-bottom:15px; object-fit: cover;">
            {% endif %}
            <h3>{{ event.title }}</h3>
            <p style="font-size: 1.1rem; color: var(--text-color);"><strong>Venue:</strong> {{ event.venue_name }}</p>
            <p style="color: #666; margin-bottom: 10px;">{{ event.venue_address }}</p>
            {% if event.date %}
            <p style="color: var(--primary-red); font-weight: 700; margin-bottom: 10px; font-size: 1rem;">&#128197; {{ event.date|date:"l, jS F Y" }}</p>
            {% endif %}
            {% if event.start_time %}
            <p style="color: var(--primary-red); font-weight: 700; margin-bottom: 15px; font-size: 1rem;">
                &#128345; <span>{{ event.start_time|time:"g:i A" }}</span>
                {% if event.end_time %}&ndash;<span>{{ event.end_time|time:"g:i A" }}</span>{% endif %}
            </p>
            {% endif %}
            {% if event.map_embed_url %}
            <iframe src="{{ event.map_embed_url }}" width="100%" height="250"
                style="border:0; border-radius:10px; margin-bottom:15px;" allowfullscreen="" loading="lazy"
                referrerpolicy="no-referrer-when-downgrade"></iframe>
            {% endif %}
            <p>{{ event.description }}</p>

            <!-- Instant toggle â€” no server call -->
            <div style="margin-top: 25px;">
                <button class="btn-primary" id="btn-{{ event.id }}"
                    onclick="toggleTicketForm('{{ event.id }}')">Book My Ticket</button>
            </div>

            <!-- Pre-rendered form, hidden by default, shown instantly on click -->
            <div id="ticket-container-{{ event.id }}" style="display:none; margin-top: 20px; text-align: left;">
                <form id="booking-form-{{ event.id }}" action="{% url 'checkout' event.id %}" method="post"
                    onsubmit="return validateBooking(this, '{{ event.id }}')">
                    {% csrf_token %}
                    <div class="ticket-container"
                        style="display:flex; flex-direction:column; gap:20px; background: #fafafa; padding: 20px; border-radius: 10px;">
                        <h4 style="margin-bottom: 5px; color: var(--primary-red); text-align: center;">
                            Select Tickets for {{ event.title }}
                        </h4>
                        {% with ticket_types=event.ticket_types.all %}
                        {% if ticket_types %}
                        <div style="display: grid; gap: 15px;">
                            {% for ticket in ticket_types %}
                            <div class="ticket-card"
                                style="padding:15px; text-align: left; display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <h4 style="margin-bottom: 5px;">{{ ticket.name }}</h4>
                                    <p style="font-size:0.9rem; color: #666; margin-bottom: 5px;">{{ ticket.description }}</p>
                                    <p class="price" style="font-size:1.2rem; margin: 0;">&#x20B9;{{ ticket.price }}</p>
                                </div>
                                <div class="quantity-control" style="margin-top: 0;">
                                    <input type="number" id="qty_{{ ticket.id }}" name="qty_{{ ticket.id }}"
                                        value="0" min="0" max="{{ ticket.quantity_available }}"
                                        data-price="{{ ticket.price }}"
                                        style="width: 60px; padding: 5px; font-size: 1rem;"
                                        oninput="updateTotal('{{ event.id }}')">
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        <div class="booking-summary"
                            style="padding:15px; background: #fff; border: 1px solid #ddd; text-align: center; margin-top: 10px;">
                            <h4 style="margin-bottom: 10px;">Booking Summary</h4>
                            <div id="total-display-{{ event.id }}"
                                style="font-size: 1.5rem; font-weight: 700; margin-bottom: 20px;">
                                Total: &#x20B9;0.00
                            </div>
                            <div style="text-align: left; display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px;">
                                <input type="text" name="customer_name" placeholder="Full Name" required
                                    style="padding: 10px; border-radius: 5px; border: 1px solid #ccc;">
                                <input type="email" name="customer_email" placeholder="Email Address" required
                                    style="padding: 10px; border-radius: 5px; border: 1px solid #ccc;">
                                <input type="tel" pattern="[0-9]{10}" maxlength="10" minlength="10"
                                    name="customer_phone" placeholder="Phone Number" required
                                    style="padding: 10px; border-radius: 5px; border: 1px solid #ccc;">
                            </div>
                            <div id="booking-error-{{ event.id }}"
                                style="display:none; background:#ffe0e0; color:#c00; border:1px solid #f99; padding:10px; border-radius:6px; margin-bottom:10px; font-weight:600;">
                                &#9888; Please select at least 1 ticket before proceeding.
                            </div>
                            <button type="submit" class="btn-primary" style="width: 100%;">Proceed to Book</button>
                        </div>
                        {% else %}
                        <p style="text-align: center;">Ticket information coming soon!</p>
                        {% endif %}
                        {% endwith %}
                    </div>
                </form>
            </div>
        </div>
        {% empty %}
        <p>Events coming soon!</p>
        {% endfor %}
    </div>
</section>

<script>
function toggleTicketForm(eventId) {
    var c = document.getElementById('ticket-container-' + eventId);
    var btn = document.getElementById('btn-' + eventId);
    if (c.style.display === 'none') {
        c.style.display = 'block';
        btn.textContent = '\u2715 Close';
        c.scrollIntoView({ behavior: 'smooth', block: 'start' });
    } else {
        c.style.display = 'none';
        btn.textContent = 'Book My Ticket';
    }
}
function updateTotal(eventId) {
    var form = document.getElementById('booking-form-' + eventId);
    var inputs = form.querySelectorAll('input[type="number"]');
    var total = 0;
    inputs.forEach(function(inp) {
        total += (parseInt(inp.value) || 0) * (parseFloat(inp.dataset.price) || 0);
    });
    document.getElementById('total-display-' + eventId).textContent = 'Total: \u20B9' + total.toFixed(2);
}
function validateBooking(form, eventId) {
    var inputs = form.querySelectorAll('input[type="number"]');
    var total = 0;
    inputs.forEach(function(i) { total += parseInt(i.value) || 0; });
    if (total === 0) {
        var err = document.getElementById('booking-error-' + eventId);
        if (err) err.style.display = 'block';
        return false;
    }
    return true;
}
</script>


<!-- Why Attend Section -->
<section class="features-section">
    <h2>Our Providing Services</h2>
    <p class="features-subtitle">Here's what makes this Holi unforgettable</p>
    <div class="features-grid">
        <div class="feature-card">
            <div class="feature-icon">&#127881;</div>
            <h3>Free Color Packets</h3>
            <p>Every attendee gets complimentary color packets to paint the celebration bright!</p>
        </div>
        <div class="feature-card">
            <div class="feature-icon">&#127926;</div>
            <h3>Best Bollywood &amp; Holi Music</h3>
            <p>Non-stop Bollywood &amp; Holi hits to keep the energy high all day long.</p>
        </div>
        <div class="feature-card">
            <div class="feature-icon">&#128266;</div>
            <h3>Best Sound System</h3>
            <p>Pro-grade audio setup for a concert-level experience under the open sky.</p>
        </div>
        <div class="feature-card">
            <div class="feature-icon">&#128247;</div>
            <h3>Selfie Booth</h3>
            <p>Capture your colorful memories at our dedicated selfie zones &amp; props booth.</p>
        </div>
        <div class="feature-card">
            <div class="feature-icon">&#127869;</div>
            <h3>Live Food Counters</h3>
            <p>Delicious food stalls and beverages to keep you fueled throughout the festival.</p>
        </div>
        <div class="feature-card">
            <div class="feature-icon">&#127807;</div>
            <h3>Organic Colors</h3>
            <p>We use only skin-safe, 100% organic and natural colors for your safety.</p>
        </div>
        <div class="feature-card">
            <div class="feature-icon">&#127942;</div>
            <h3>Best Anchor &amp; Surprise Gifts</h3>
            <p>Exciting games, a high-energy anchor, and surprise gift giveaways for everyone!</p>
        </div>
    </div>
</section>

{% endblock %}
